console.log("Background service worker loaded");chrome.runtime.onInstalled.addListener(e=>{console.log("Extension installed:",e.reason),chrome.storage.sync.set({extensionEnabled:!0,theme:"light"})});chrome.tabs.onUpdated.addListener((e,o,t)=>{o.status==="complete"&&t.url&&(console.log("Tab updated:",t.url),chrome.tabs.sendMessage(e,{type:"PAGE_LOADED",url:t.url}).catch(()=>{}))});chrome.runtime.onMessage.addListener((e,o,t)=>{switch(console.log("Background received message:",e),e.type){case"GET_TAB_INFO":o.tab&&t({tabId:o.tab.id,url:o.tab.url,title:o.tab.title});break;case"TOGGLE_EXTENSION":return chrome.storage.sync.get(["extensionEnabled"],a=>{const n=!a.extensionEnabled;chrome.storage.sync.set({extensionEnabled:n}),chrome.tabs.query({},r=>{r.forEach(s=>{s.id&&chrome.tabs.sendMessage(s.id,{type:"EXTENSION_TOGGLED",enabled:n}).catch(()=>{})})}),t({enabled:n})}),!0;default:console.log("Unknown message type:",e.type)}});chrome.action.onClicked.addListener(e=>{e.id&&chrome.sidePanel.open({tabId:e.id})});chrome.storage.onChanged.addListener((e,o)=>{console.log("Storage changed:",e,o),chrome.tabs.query({},t=>{t.forEach(a=>{a.id&&chrome.tabs.sendMessage(a.id,{type:"STORAGE_CHANGED",changes:e}).catch(()=>{})})})});
